name: Modular TinyTeX Build

# æ‰‹åŠ¨è§¦å‘
on: workflow_dispatch

jobs:
  build-and-test:
    runs-on: windows-latest
    
    steps:
    # 1. æ‹‰å–ä»£ç 
    - name: Checkout Repository
      uses: actions/checkout@v3

    # 2. ã€æ ¸å¿ƒä¿®æ”¹ã€‘ç¯å¢ƒéªŒè¯ç”± Workflow äº²è‡ªå®Œæˆ
    - name: Verify Windows Environment
      shell: powershell
      run: |
        Write-Host "ğŸ” æ­£åœ¨è¿›è¡Œç¯å¢ƒé¢„æ£€..."
        
        # æ£€æŸ¥æ“ä½œç³»ç»Ÿ
        Write-Host "OS Core: $env:OS"
        if ($env:OS -ne "Windows_NT") { 
            throw "âŒ éªŒè¯å¤±è´¥ï¼šè¿™å°æœºå™¨ä¸æ˜¯ Windowsï¼" 
        }
        
        # æ£€æŸ¥ç›˜ç¬¦ (éªŒè¯æ˜¯å¦ä¸ºæ ‡å‡† Windows æ–‡ä»¶ç³»ç»Ÿ)
        if (-not (Test-Path "C:\")) { 
            throw "âŒ éªŒè¯å¤±è´¥ï¼šæ‰¾ä¸åˆ° C ç›˜ï¼" 
        }
        
        Write-Host "âœ… ç¯å¢ƒéªŒè¯é€šè¿‡ï¼šæ˜¯æ ‡å‡†çš„ Windows Serverã€‚"

    # 3. è°ƒç”¨çº¯å‡€çš„å®‰è£…è„šæœ¬
    - name: Run Install Script
      shell: powershell
      run: .\install.ps1

    # 4. ç¼–è¯‘ PDF
    - name: Compile PDF
      # æ­¤æ—¶ç¯å¢ƒå˜é‡é‡Œå·²ç»æœ‰ xelatex äº†
      run: xelatex -interaction=nonstopmode test.tex

    # 5. ä¸Šä¼ ç»“æœ
    - name: Upload Artifact
      if: success()
      uses: actions/upload-artifact@v4
      with:
        name: final-report
        path: test.pdf