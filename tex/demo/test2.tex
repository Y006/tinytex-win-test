% ===================================================================
% 文件名: tex/demo/main.tex
% 用途: TinyTeX 环境自检报告 (修复冲突版)
% ===================================================================

% [Group 2] 强制指定 Fandol 字体
\PassOptionsToPackage{fontset=fandol}{ctex}

\documentclass[a4paper, 12pt]{article}

% ===================================================================
% 0. 宏包加载区
% ===================================================================

% --- [Group 2] 中文支持 ---
\usepackage{ctex}
\usepackage{zhnumber}

% --- [Group 3] 基础数学 (移除 newtx 以避免依赖问题) ---
\usepackage{iftex}
\usepackage{amsmath, amsfonts, amssymb}
\usepackage{esint}

% --- [Group 4] 模板逻辑 ---
\usepackage{appendix}
\usepackage{abstract}
\usepackage{hologo}
\usepackage[stable]{footmisc}
\usepackage{etoolbox}

% --- [Group 5] 格式与功能 ---
\usepackage[margin=2.5cm]{geometry}
\usepackage{xcolor}
\usepackage{graphicx}
\usepackage{mwe}
\usepackage{booktabs}
\usepackage{multirow}
\usepackage{makecell}
\usepackage{caption}
\usepackage{subcaption}
\usepackage{enumitem}
\usepackage{listings}
\usepackage{fancyvrb}
\usepackage{siunitx}
\usepackage{microtype}
\usepackage{tikz}
\usepackage[colorlinks=true, linkcolor=blue]{hyperref}
\usepackage{cleveref}

% --- [Group 6] 学术增强 (注意：移除了 natbib 以避免冲突) ---
\usepackage{fancyhdr}
\usepackage{setspace}
\usepackage{algorithm}
\usepackage{algpseudocode}
\usepackage{longtable}
\usepackage{threeparttable}
\usepackage{mhchem}
\usepackage{pdfpages}
% \usepackage{natbib}  <--- 关键！必须注释掉，因为它和 biblatex 冲突

% --- [Group 5] 参考文献 (biblatex + biber) ---
\usepackage[style=gb7714-2015, backend=biber]{biblatex}

% ===================================================================
% 1. 准备数据
% ===================================================================
\begin{filecontents}[overwrite]{ref.bib}
@manual{tinytex,
  title  = {TinyTeX Documentation},
  author = {Yihui Xie},
  year   = {2024},
  url    = {https://yihui.org/tinytex/}
}
\end{filecontents}
\addbibresource{ref.bib}

% TikZ 设置
\usetikzlibrary{shapes.geometric, arrows}

% ===================================================================
% 正文
% ===================================================================
\title{\textbf{TinyTeX 最终修复版测试}}
\author{CI/CD Bot}
\date{\zhtoday}

\begin{document}

\maketitle

\begin{abstract}
    本报告移除了 \texttt{natbib} 与 \texttt{newtx}，确保与 \texttt{biblatex} 无冲突，且不依赖复杂字体包。
    主要验证：中文支持、学术表格、算法排版、绘图及参考文献生成。
\end{abstract}

\section{功能模块测试}

\subsection{中文与数学}
中文显示正常（\zhnumber{2025}）。默认数学字体测试：
\begin{equation}
    \oint \mathbf{E} \cdot d\mathbf{l} = -\frac{d}{dt} \iint \mathbf{B} \cdot d\mathbf{S}
\end{equation}

\subsection{学术功能 (Group 6)}
\textbf{伪代码测试}：
\begin{algorithm}[H]
    \caption{测试算法}
    \begin{algorithmic}[1]
        \State Init $x \gets 0$
        \State \Return $x$
    \end{algorithmic}
\end{algorithm}

\textbf{化学公式}：\ce{H2O -> H+ + OH-}

\subsection{参考文献}
这里引用了 TinyTeX\cite{tinytex}。请检查文末列表。

\printbibliography[heading=bibintoc, title=参考文献]

\end{document}